CREATE TABLE CLIENTE (
 CPF             CHAR(11)      NOT NULL
,Nome            VARCHAR(50)   NOT NULL
);
ALTER TABLE CLIENTE ADD CONSTRAINT
PRIMARY KEY (CPF);

CREATE TABLE ASSOCIADO (
 CNPJ            CHAR(14)      NOT NULL
,RazaoSocial     VARCHAR(50)   NOT NULL
);
ALTER TABLE ASSOCIADO ADD CONSTRAINT
PRIMARY KEY (CNPJ);

CREATE TABLE INDICADOR (
 Ident           INT           NOT NULL
,Nome            VARCHAR(50)   NOT NULL
,FormulaDefault  VARCHAR(255)  NOT NULL
);
ALTER TABLE INDICADOR ADD CONSTRAINT
PRIMARY KEY (Ident);

CREATE TABLE CONTRATO (
 CNPJ               CHAR(14)      NOT NULL
,IdentIndicador     INT           NOT NULL
,Nome               VARCHAR(50)   NOT NULL
,FormulaAssociado   VARCHAR(255)      NULL
,DataContrato       DATE          NOT NULL
);
ALTER TABLE CONTRATO ADD CONSTRAINT
PRIMARY KEY (CNPJ, IdentIndicador);
ALTER TABLE CONTRATO ADD CONSTRAINT
FOREIGN KEY (CNPJ) REFERENCES ASSOCIADO (CNPJ);
ALTER TABLE CONTRATO ADD CONSTRAINT
FOREIGN KEY (IdentIndicador) REFERENCES INDICADOR (Ident);

CREATE TABLE CALCULO (
 CPF                CHAR(11)      NOT NULL
,DataHora           DATE          NOT NULL
,ValorCalc          NUMERIC(10,2) NOT NULL
,CNPJ               CHAR(14)      NOT NULL
,IdentIndicador     INT           NOT NULL
);
ALTER TABLE CALCULO ADD CONSTRAINT
PRIMARY KEY (CPF, DataHora);
ALTER TABLE CALCULO ADD CONSTRAINT
FOREIGN KEY (CPF) REFERENCES CLIENTE (CPF);
ALTER TABLE CALCULO ADD CONSTRAINT
FOREIGN KEY (CNPJ) REFERENCES ASSOCIADO (CNPJ);
ALTER TABLE CALCULO ADD CONSTRAINT
FOREIGN KEY (IdentIndicador) REFERENCES INDICADOR (Ident);

CREATE TABLE DIVIDA (
 CNPJ               CHAR(14)      NOT NULL
,Ident              VARCHAR(255)  NOT NULL
,Tipo               VARCHAR(10)   NOT NULL
,DataVencto         DATE          NOT NULL
,Valor              NUMERIC(10,2) NOT NULL
,DataPagto          DATE              NULL
,ValorPagto         NUMERIC(10,2)     NULL
,CPF                CHAR(11)      NOT NULL
);
ALTER TABLE DIVIDA ADD CONSTRAINT
PRIMARY KEY (CNPJ, DataHora);
ALTER TABLE DIVIDA ADD CONSTRAINT
FOREIGN KEY (CNPJ) REFERENCES ASSOCIADO (CNPJ);
ALTER TABLE DIVIDA ADD CONSTRAINT
FOREIGN KEY (CPF) REFERENCES CLIENTE (CPF);
ALTER TABLE DIVIDA ADD CONSTRAINT
CHECK (Valor > 0);
ALTER TABLE DIVIDA ADD CONSTRAINT
CHECK (ValorPagto > 0);

CREATE TABLE CREDITO (
 CPF                CHAR(11)      NOT NULL
,DataHora           DATE          NOT NULL
,ValorCredito       NUMERIC(10,2) NOT NULL
,SeAprovado         BOOLEAN       NOT NULL
,CNPJ               CHAR(14)      NOT NULL
);
ALTER TABLE CREDITO ADD CONSTRAINT
PRIMARY KEY (CPF, DataHora);
ALTER TABLE CREDITO ADD CONSTRAINT
FOREIGN KEY (CPF) REFERENCES CLIENTE (CPF);
ALTER TABLE CREDITO ADD CONSTRAINT
FOREIGN KEY (CNPJ) REFERENCES ASSOCIADO (CNPJ);
ALTER TABLE CREDITO ADD CONSTRAINT
CHECK (ValorCredito > 0);

CREATE TABLE CONSULTA (
 CPF                CHAR(11)      NOT NULL
,DataHora           DATE          NOT NULL
,TipoConsulta       VARCHAR(10)   NOT NULL
);
ALTER TABLE CONSULTA ADD CONSTRAINT
PRIMARY KEY (CPF, DataHora);
ALTER TABLE CONSULTA ADD CONSTRAINT
FOREIGN KEY (CPF) REFERENCES CLIENTE (CPF);

